name: Content Type Regression (Phase A)

on:
  workflow_dispatch:

jobs:
  regression-test:
    runs-on: [self-hosted, macOS, preprod]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Show Python
        run: |
          which python3 || true
          python3 --version
          python3 -m pip --version || true

      - name: Install dependencies
        run: |
          python3 -m pip install --upgrade pip
          python3 -m pip install -r requirements.txt || true
          python3 -m pip install pytest requests pytest-html
          python3 -m pip show pytest
          python3 -m pytest --version


      - name: Run Pytest (generate reports)
        run: |
          mkdir -p reports
          python3 -m pytest -v -s tests \
            --junitxml=reports/junit.xml \
            --html=reports/report.html --self-contained-html


      - name: List reports
        if: always()
        run: |
          ls -la reports || true
